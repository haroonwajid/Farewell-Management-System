<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="index.js"></script>
    <title>WP | Buy Ticket</title>
</head>
<body>
    <header> Farewell Party </header>

    <ul>
        <li><a href="/main">Home</a></li>
        <li class="dropdown">
            <a href="javascript:void(0)" class="dropbtn">View</a>
            <div class="dropdown-content">
                <a href="/vote">Vote on Menu</a>
                <!-- <a href="/diet">Dietary Preferences</a> -->
                <!-- <a href="/family">Family</a> -->
                <a href="/performance">Performance Proposal</a>
            </div>
        </li>
        <li><a href="/ticket">Buy Ticket</a></li>
        <li style="float:right" class="dropdown">
            <a href="javascript:void(0)" class="dropbtn">Account</a>
            <div class="dropdown-content">
                <a href="/editprofile">Edit Profile</a>
                <a href="/login">Log out</a>
            </div>
        </li>
    </ul>


    <!-- Ticket Buying Form -->
    <form action="/buyTicket" method="post">
        <div class="container">
            <h2>Buy Ticket</h2>

            <label for="numTickets">Number of Tickets</label>
            <input type="number" placeholder="Enter number of tickets" name="numTickets" id="numTickets" required onchange="calculateAmount()">

            <label for="cardNumber">Card Number</label>
            <input type="text" placeholder="Enter card number" name="cardNumber" required>

            <label for="expiryDate">Expiry Date</label>
            <input type="text" placeholder="MM/YYYY" name="expiryDate" required>

            <label for="cvv">CVV</label>
            <input type="password" placeholder="Enter CVV" name="cvv" required>

            <!-- Family Member Information -->
            <div id="familyMembers">
                <h3>Family Members</h3>
                <button type="button" onclick="addFamilyMember()">Add Family Member</button>

                <!-- Dynamic Family Member Fields Will Be Added Here -->
            </div>

            <div id="amountContainer">
                <h3>Amount to be Paid</h3>
                <p id="amountDetails"></p>
                <p>Payment to be made at the stall in the cafe.</p>
            </div>

            <button type="submit">Buy Now</button>
        </div>
    </form>

    <script>
        let familyMemberCount = 0;

        function addFamilyMember() {
            familyMemberCount++;

            const familyMembersContainer = document.getElementById('familyMembers');

            const familyMemberFields = document.createElement('div');
            familyMemberFields.innerHTML = `
                <h4>Family Member ${familyMemberCount}</h4>
                <label for="familyName${familyMemberCount}">Name</label>
                <input type="text" placeholder="Enter name" name="familyName${familyMemberCount}" required>

                <label for="familyAge${familyMemberCount}">Age</label>
                <input type="number" placeholder="Enter age" name="familyAge${familyMemberCount}" required>
            `;

            familyMembersContainer.appendChild(familyMemberFields);
        }

        function calculateAmount() {
            const numTickets = document.getElementById('numTickets').value;
            const amount = numTickets * 500;

            const amountDetails = document.getElementById('amountDetails');
            amountDetails.innerHTML = `Total Amount: ${amount} Rs`;
        }

        function submitForm(event) {
            event.preventDefault();

            // Your AJAX request to submit the form data to the server
            const formData = new FormData(document.getElementById('ticketForm'));

            // Replace the following URL with the actual server-side endpoint
            const url = '/buyTicket';

            fetch(url, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error('Failed to buy tickets');
                }
            })
            .then(data => {
                alert('Tickets successfully bought!');
                window.location.href = '/main'; // Redirect to the home page
            })
            .catch(error => {
                console.error('Error:', error);
                // Handle error if needed
            });
        }
    </script>
</body>
</html>

<style>
    /* Header styles */
    header {
        font-weight: bolder;
        font-size: xx-large;
        /* background-color: #04AA6D; */
        background-color: rgb(89, 5, 5);
        text-align: center;
        padding: 20px;
        font-family: Arial, Helvetica, sans-serif;
    }

    /* Navigation bar styles */
    body {
        /* background-color: ivory; */
        margin: 0;
        font-family: Arial, sans-serif;
        color: white;
        background-color: rgb(147, 56, 56);
    }

    ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: rgb(128, 8, 8);
        font-family: Arial, sans-serif;
    }

    li {
        float: left;
    }

    li a, .dropbtn {
        display: inline-block;
        color: white;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
    }

    li a:hover, .dropdown:hover .dropbtn {
        background-color: #555;
    }

    li.dropdown {
        display: inline-block;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        z-index: 1;
    }

    .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        text-align: left;
    }

    .dropdown-content a:hover {
        background-color: #f1f1f1;
    }

    .dropdown:hover .dropdown-content {
        display: block;
    }

    /* Ticket buying form styles */
    form {
        border: 3px solid #f1f1f1;
        /* background-color: #fff; */
        background-color: rgb(247, 188, 179);
        padding: 20px;
        width: 50%;
        margin: auto;
        margin-top: 50px;
        border-radius: 10px;
        color:black;
    }

    .container {
        text-align: center;
    }

    label {
        display: block;
        margin: 10px 0;
        font-weight: bold;
    }

    input {
        width: 100%;
        padding: 12px 20px;
        margin: 8px 0;
        display: inline-block;
        border: 1px solid #ccc;
        box-sizing: border-box;
        border-radius: 5px;
    }

    button {
        /* background-color: #04AA6D; */
        background-color: rgb(128, 8, 8);
        color: white;
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        cursor: pointer;
        width: 100%;
        border-radius: 5px;
    }

    button:hover {
        opacity: 0.8;
    }
</style>
